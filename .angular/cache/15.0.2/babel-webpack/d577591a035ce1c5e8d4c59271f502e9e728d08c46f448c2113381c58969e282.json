{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { IonContent } from '@ionic/angular';\nimport { environment } from '../../../../../../environments/environment';\nlet LocationsPage = class LocationsPage {\n  constructor(router, connApi, formBuilder, toastController, alertController, dataService) {\n    this.router = router;\n    this.connApi = connApi;\n    this.formBuilder = formBuilder;\n    this.toastController = toastController;\n    this.alertController = alertController;\n    this.dataService = dataService;\n    //Constants\n    this.maxZip = environment.maxZip;\n    this.maxInput = environment.maxInput;\n    // Urls\n    this.urlLocation = 'collector/location';\n    this.urlLocationActive = 'collector/location/active';\n    this.urlLocations = 'collector/locations';\n    // FormBuilder\n    this.fgLocation = this.formBuilder.group({\n      cName: ['', [Validators.required, Validators.maxLength(this.maxInput)]],\n      cWebsite: ['', [Validators.maxLength(this.maxInput)]],\n      cStreet: ['', [Validators.required, Validators.maxLength(this.maxInput)]],\n      cStreetNumber: ['', [Validators.required, Validators.maxLength(this.maxInput)]],\n      cZip: ['', [Validators.required, Validators.minLength(this.maxZip), Validators.maxLength(this.maxZip)]],\n      cCity: ['', [Validators.required, Validators.maxLength(this.maxInput)]]\n    });\n    // Variables\n    this.bEdit = false;\n    this.bAdd = false;\n    this.bSubmitted = false;\n    this.lLocationsActive = [];\n    this.lLocationsNotActive = [];\n    this.oLocationEdit = null;\n    this.bAccessEdit = false;\n  }\n  ngOnInit() {\n    this.load();\n  }\n  load() {\n    this.lLocationsActive = [];\n    this.lLocationsNotActive = [];\n    // Get Locations\n    this.connApi.safeGet(this.urlLocations).subscribe(response => {\n      console.log(response.body);\n      let lLocations = response.body;\n      lLocations.forEach(location => {\n        if (location.bActive == 1) {\n          this.lLocationsActive.push(location);\n        } else {\n          this.lLocationsNotActive.push(location);\n        }\n      });\n      if (lLocations.length == 0) this.bAdd = true;\n    });\n  }\n  onSaveAdd() {\n    this.bSubmitted = true;\n    // check for invalid input\n    if (!this.fgLocation.valid) {\n      this.alertInvalid();\n      return;\n    }\n    // prepare\n    let location = {\n      cName: this.fgLocation.get('cName').value,\n      cWebsite: this.fgLocation.get('cWebsite').value,\n      cStreet: this.fgLocation.get('cStreet').value,\n      cStreetNumber: this.fgLocation.get('cStreetNumber').value,\n      cZip: this.fgLocation.get('cZip').value,\n      cCity: this.fgLocation.get('cCity').value,\n      bAccess: this.bAccessEdit ? 1 : 0\n    };\n    // send\n    this.connApi.safePut(this.urlLocation, location).subscribe(data => {\n      if (data.status == 200) {\n        this.dataService.callLocation(null);\n        this.bAdd = false;\n        this.bSubmitted = false;\n        const location = data.body;\n        this.lLocationsNotActive.push(location);\n        this.alertAdded(location);\n        this.fgLocation.reset();\n        this.bAccessEdit = false;\n      }\n    }, error => {\n      console.log(error);\n      if (error.status == 406) {\n        this.alertLocationForgiven();\n      }\n    });\n  }\n  onSaveEdit() {\n    this.bSubmitted = true;\n    // check for invalid input\n    if (!this.fgLocation.valid) {\n      this.alertInvalid();\n      return;\n    }\n    // prepare\n    this.oLocationEdit.cName = this.fgLocation.get('cName').value;\n    this.oLocationEdit.cWebsite = this.fgLocation.get('cWebsite').value;\n    this.oLocationEdit.cStreet = this.fgLocation.get('cStreet').value;\n    this.oLocationEdit.cStreetNumber = this.fgLocation.get('cStreetNumber').value;\n    this.oLocationEdit.cZip = this.fgLocation.get('cZip').value;\n    this.oLocationEdit.cCity = this.fgLocation.get('cCity').value;\n    this.oLocationEdit.bAccess = this.bAccessEdit ? 1 : 0;\n    // send\n    this.connApi.safePost(this.urlLocation, this.oLocationEdit).subscribe(data => {\n      if (data.status == 200) {\n        this.dataService.callLocation(null);\n        this.bEdit = false;\n        this.bSubmitted = false;\n        this.fgLocation.reset();\n        this.oLocationEdit = null;\n        this.bAccessEdit = false;\n      }\n    }, error => {\n      console.log(error);\n      if (error.status == 406) {\n        this.alertLocationForgiven();\n      }\n    });\n  }\n  get errorControl() {\n    return this.fgLocation.controls;\n  }\n  ping($event) {\n    const location = $event.object;\n    if ('check' === $event.label) {\n      this.upload(location);\n      if (location.bActive) {\n        this.lLocationsActive.push(location);\n        this.lLocationsNotActive.splice(this.lLocationsNotActive.indexOf(location), 1);\n      } else {\n        this.lLocationsNotActive.push(location);\n        this.lLocationsActive.splice(this.lLocationsActive.indexOf(location), 1);\n      }\n    }\n    if ('edit' == $event.label) {\n      this.onEdit(location);\n    }\n    if ('delete' == $event.label) {\n      this.onDelete(location);\n    }\n  }\n  upload(location) {\n    console.log(location);\n    this.connApi.safePost(this.urlLocation, location).subscribe(response => {\n      console.log(response);\n    }, error => {\n      console.log(error);\n    });\n  }\n  onEdit(location) {\n    this.oLocationEdit = location;\n    this.bAccessEdit = location.bAccess == 1;\n    this.isEditing(true);\n    // data\n    this.fgLocation.controls['cName'].setValue(location.cName);\n    this.fgLocation.controls['cWebsite'].setValue(location.cWebsite);\n    this.fgLocation.controls['cStreetNumber'].setValue(location.cStreetNumber);\n    this.fgLocation.controls['cStreet'].setValue(location.cStreet);\n    this.fgLocation.controls['cZip'].setValue(location.cZip);\n    this.fgLocation.controls['cCity'].setValue(location.cCity);\n    // scroll to top\n    this.content.scrollToTop(400);\n  }\n  onDelete(location) {\n    this.alertDelete(location);\n  }\n  isAdding(bAdd) {\n    this.bAdd = bAdd;\n    if (!bAdd) {\n      this.fgLocation.reset();\n    } else {\n      this.bEdit = false;\n    }\n  }\n  isEditing(bEdit) {\n    this.bEdit = bEdit;\n    if (!bEdit) {\n      this.fgLocation.reset();\n      this.oLocationEdit = null;\n    } else {\n      this.bAdd = false;\n    }\n  }\n  alertInvalid() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const alert = yield this.alertController.create({\n        header: 'Fehlerhafte Eingabe',\n        message: 'Bitte überprüfe deine Daten und korrigiere diese an den markierten Stellen.',\n        cssClass: 'my-alert',\n        buttons: ['Ok']\n      });\n      yield alert.present();\n    });\n  }\n  // Toasts\n  toastSaved() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const toast = yield this.toastController.create({\n        message: 'Deine Daten wurden erfolgreich gespeichert.',\n        duration: 2500,\n        cssClass: 'my-toast',\n        position: 'bottom'\n      });\n      yield toast.present();\n    });\n  }\n  alertLocationForgiven() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const alert = yield this.alertController.create({\n        header: 'Hinzufügen nicht möglich',\n        subHeader: 'Sammelstandort existiert bereits',\n        message: 'Bitte prüfe ob an diesem Sammelstandort bereits eine Mobile-Box steht, falls nicht melde dich bitte per Mail bei uns, damit wir diesen Standort freigeben können.',\n        cssClass: 'my-alert',\n        buttons: ['Ok']\n      });\n      yield alert.present();\n    });\n  }\n  alertDelete(locaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const alert = yield this.alertController.create({\n        header: 'Wirklich löschen?',\n        subHeader: locaction.cName,\n        cssClass: 'my-alert',\n        buttons: [{\n          text: 'Bestätigen',\n          handler: () => {\n            console.log(locaction.id);\n            this.connApi.safeDelete(this.urlLocation + \"/\" + locaction.id).subscribe(response => {\n              this.dataService.callLocation(null);\n              console.log(response);\n              if (locaction.bActive == 1) {\n                this.lLocationsActive.splice(this.lLocationsActive.indexOf(locaction), 1);\n              } else {\n                this.lLocationsNotActive.splice(this.lLocationsNotActive.indexOf(locaction), 1);\n              }\n            }, error => {\n              console.log(error);\n            });\n          }\n        }, {\n          text: 'Abrechen',\n          role: 'cancel'\n        }]\n      });\n      yield alert.present();\n    });\n  }\n  alertAdded(locaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const alert = yield this.alertController.create({\n        header: 'Sammelstandort hinzugefügt',\n        subHeader: locaction.cName,\n        message: 'Wir haben diesen Sammelstandort zunächst auf inaktiv gesetzt. Wenn dort bereits eine Sammelbox steht, klicke bitte auf Aktivieren. Wenn du bereits eine Sammelbox für diesen Sammelstandort vorliegen hast, diese aber erst ' + 'später aufstellen möchtest, klicke bitte auf später und aktiviere den Sammelstandort sobald die Sammelbox aufgestellt wurde. Dazu klickst du bitte auf die Checkbox des Sammelstandortes. Wenn du für diesen Sammelstandort noch keine Sammelbox ' + 'vorliegen hast und auch noch keine bestellt hast, klicke bitte auf Bestellen.',\n        cssClass: 'my-alert',\n        buttons: [{\n          text: 'Aktivieren',\n          handler: () => {\n            // prepare\n            let data = {\n              id: locaction.id\n            };\n            this.connApi.safePost(this.urlLocationActive, data).subscribe(response => {\n              this.load();\n            });\n          }\n        }, {\n          text: 'Später'\n        }, {\n          text: 'Bestellen',\n          handler: () => {\n            this.router.navigate(['collector/menu/order/tabs/add']);\n          }\n        }]\n      });\n      yield alert.present();\n    });\n  }\n  onToggleAccess($event) {}\n};\n__decorate([ViewChild(IonContent)], LocationsPage.prototype, \"content\", void 0);\nLocationsPage = __decorate([Component({\n  selector: 'app-locations',\n  templateUrl: './locations.page.html',\n  styleUrls: ['./locations.page.scss']\n})], LocationsPage);\nexport { LocationsPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}