{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Validators } from '@angular/forms';\nimport { Downloads } from '../../utilities/downloads';\nimport { Alert } from \"../../utilities/alert\";\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../utilities/alert\";\nimport * as i2 from \"../../utilities/downloads\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"../../services/auth-api/auth-api.service\";\nimport * as i5 from \"../../services/conn-api/conn-api.service\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"../../services/data/data.service\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"../../components/footer/footer.component\";\nfunction LoginPage_form_22_span_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 25);\n    i0.ɵɵtext(1, \"Pflichtfeld\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoginPage_form_22_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 25);\n    i0.ɵɵtext(1, \"Fehlerhafte Eingabe\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoginPage_form_22_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Maximal-L\\u00E4nge von \", ctx_r4.maxInput, \" Zeichen \\u00FCberschritten\");\n  }\n}\nfunction LoginPage_form_22_span_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 25);\n    i0.ɵɵtext(1, \"Pflichtfeld\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LoginPage_form_22_span_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Maximal-L\\u00E4nge von \", ctx_r6.maxInput, \" Zeichen \\u00FCberschritten\");\n  }\n}\nfunction LoginPage_form_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 14);\n    i0.ɵɵlistener(\"keyup.enter\", function LoginPage_form_22_Template_form_keyup_enter_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.onLoginCollector());\n    })(\"ngSubmit\", function LoginPage_form_22_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.onLoginCollector());\n    });\n    i0.ɵɵelementStart(1, \"ion-row\")(2, \"ion-col\", 15)(3, \"ion-item\", 16)(4, \"ion-label\", 17);\n    i0.ɵɵtext(5, \"E-Mail\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"ion-input\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, LoginPage_form_22_span_7_Template, 2, 0, \"span\", 19);\n    i0.ɵɵtemplate(8, LoginPage_form_22_span_8_Template, 2, 0, \"span\", 19);\n    i0.ɵɵtemplate(9, LoginPage_form_22_span_9_Template, 2, 1, \"span\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"ion-col\", 15)(11, \"ion-item\", 16)(12, \"ion-label\", 17);\n    i0.ɵɵtext(13, \"Passwort\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"ion-input\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(15, LoginPage_form_22_span_15_Template, 2, 0, \"span\", 19);\n    i0.ɵɵtemplate(16, LoginPage_form_22_span_16_Template, 2, 1, \"span\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(17, \"br\");\n    i0.ɵɵelementStart(18, \"ion-row\", 21)(19, \"ion-col\", 22)(20, \"ion-button\", 23);\n    i0.ɵɵtext(21, \"Anmelden\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"ion-col\", 22)(23, \"ion-button\", 24);\n    i0.ɵɵlistener(\"click\", function LoginPage_form_22_Template_ion_button_click_23_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.onResetPassword());\n    });\n    i0.ɵɵtext(24, \"Passwort vergessen \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(25, \"ion-col\", 22)(26, \"ion-button\", 24);\n    i0.ɵɵlistener(\"click\", function LoginPage_form_22_Template_ion_button_click_26_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.navRegisterCollector());\n    });\n    i0.ɵɵtext(27, \"Registrieren \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.loginFormCollector);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.bSubmittedCollector && (ctx_r0.errorControlCollector.cEmail.errors == null ? null : ctx_r0.errorControlCollector.cEmail.errors.required));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.bSubmittedCollector && (ctx_r0.errorControlCollector.cEmail.errors == null ? null : ctx_r0.errorControlCollector.cEmail.errors.pattern));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.bSubmittedCollector && (ctx_r0.errorControlCollector.cEmail.errors == null ? null : ctx_r0.errorControlCollector.cEmail.errors.maxlength));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.bSubmittedCollector && (ctx_r0.errorControlCollector.cPassword.errors == null ? null : ctx_r0.errorControlCollector.cPassword.errors.required));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.bSubmittedCollector && (ctx_r0.errorControlCollector.cPassword.errors == null ? null : ctx_r0.errorControlCollector.cPassword.errors.maxlength));\n  }\n}\nfunction LoginPage_form_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"form\", 26);\n    i0.ɵɵlistener(\"ngSubmit\", function LoginPage_form_23_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.onLoginCollector());\n    });\n    i0.ɵɵelementStart(1, \"ion-row\")(2, \"ion-col\", 15)(3, \"ion-item\", 16)(4, \"ion-label\", 17);\n    i0.ɵɵtext(5, \"E-Mail\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"ion-input\", 27);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"ion-col\", 15)(8, \"ion-item\", 16)(9, \"ion-label\", 17);\n    i0.ɵɵtext(10, \"Passwort\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"ion-input\", 20);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(12, \"br\");\n    i0.ɵɵelementStart(13, \"ion-row\", 21)(14, \"ion-col\", 22)(15, \"ion-button\", 28);\n    i0.ɵɵtext(16, \"Anmelden\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.loginFormPartner);\n    i0.ɵɵadvance(3);\n    i0.ɵɵclassProp(\"ion-invalid\", true);\n  }\n}\nconst _c0 = function () {\n  return {\n    \"ion-margin-vertical\": true,\n    \"input-background\": true\n  };\n};\nexport let LoginPage = /*#__PURE__*/(() => {\n  class LoginPage {\n    constructor(Alert, Downloads, alertController, authApiService, connApiService, router, fb, data) {\n      this.Alert = Alert;\n      this.Downloads = Downloads;\n      this.alertController = alertController;\n      this.authApiService = authApiService;\n      this.connApiService = connApiService;\n      this.router = router;\n      this.fb = fb;\n      this.data = data;\n      //Constants\n      this.maxInput = environment.maxInput;\n      // Urls\n      this.urlLogin = 'login';\n      this.bSubmittedCollector = false;\n      this.bSubmittedPartner = false;\n      this.loginFormPartner = this.fb.group({\n        cEmail: ['', [Validators.required, Validators.pattern('^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z0-9._%+-]{2,15}$'), Validators.maxLength(this.maxInput)]],\n        cPassword: ['', [Validators.required, Validators.maxLength(this.maxInput)]]\n      });\n      this.loginFormCollector = this.fb.group({\n        cEmail: ['', [Validators.required, Validators.pattern('^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z0-9._%+-]{2,15}$'), Validators.maxLength(this.maxInput)]],\n        cPassword: ['', [Validators.required, Validators.maxLength(this.maxInput)]]\n      });\n      console.log('teeest');\n    }\n    ngOnInit() {\n      console.log('ngOnInit: LoginPage');\n      //this.data.currentRole.subscribe(role => console.log(this.selectedRole = role))\n      this.selectedRole = 1;\n      localStorage.setItem('bPopUp', 'false');\n    }\n    segmentChanged(ev) {\n      console.log('Segment changed', ev);\n      this.data.changeRole(ev['detail']['value']);\n    }\n    login(role) {\n      // check\n      // check for invalid input\n      if (role == 1) {\n        this.bSubmittedCollector = true;\n        if (!this.loginFormCollector.valid) {\n          this.getFormValidationErrorsCollector();\n          this.alertInvalid();\n          return;\n        }\n      }\n      if (role == 2) {\n        this.bSubmittedPartner = true;\n        if (!this.loginFormPartner.valid) {\n          //this.getFormValidationErrors();\n          this.alertInvalid();\n          return;\n        }\n      }\n      // prepare\n      let data = {\n        'role': role,\n        'email': this.loginFormCollector.get('cEmail').value,\n        'password': this.loginFormCollector.get('cPassword').value\n      };\n      this.connApiService.post(this.urlLogin, data).subscribe(data => {\n        if (data.status == 200) {\n          // Save token\n          console.log(data.headers.get('authorization'));\n          localStorage.setItem('token', data.headers.get('authorization'));\n          // Navigate\n          this.router.navigate(['app-root']);\n        }\n      }, error => {\n        if (error.status == 401) {\n          this.Alert.invalidInput('E-Mail unbekannt');\n        }\n        if (error.status == 403) {\n          this.Alert.invalidInput('Passwort falsch');\n        }\n      });\n    }\n    getFormValidationErrorsCollector() {\n      Object.keys(this.loginFormCollector.controls).forEach(key => {\n        const controlErrors = this.loginFormCollector.get(key).errors;\n        if (controlErrors != null) {\n          Object.keys(controlErrors).forEach(keyError => {\n            console.log('Key control: ' + key + ', keyError: ' + keyError + ', err value: ', controlErrors[keyError]);\n          });\n        }\n      });\n    }\n    get errorControlCollector() {\n      return this.loginFormCollector.controls;\n    }\n    get errorControlPartner() {\n      return this.loginFormPartner.controls;\n    }\n    onLoginCollector() {\n      this.login(1);\n    }\n    onLoginPartner() {\n      this.login(2);\n    }\n    navRegisterCollector() {\n      this.router.navigate(['registration-collector/id/0']);\n    }\n    onResetPassword() {\n      this.router.navigate(['request/role/' + this.selectedRole]);\n    }\n    // Alert\n    alertWrongLoginCredentials(subheader) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const alert = yield this.alertController.create({\n          cssClass: 'my-alert',\n          header: 'Ungültige Eingabe',\n          subHeader: subheader,\n          message: 'Bitte überprüfe und korrigiere deine Eingabe.',\n          buttons: ['Ok']\n        });\n        yield alert.present();\n      });\n    }\n    alertInvalid() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const alert = yield this.alertController.create({\n          cssClass: 'my-alert',\n          header: 'Ungültige Eingabe',\n          message: 'Bitte überprüfe deine Daten und korrigiere diese an den markierten Stellen.',\n          buttons: ['Ok']\n        });\n        yield alert.present();\n      });\n    }\n    onInfo() {\n      this.Downloads.becomeCollector();\n    }\n    isCollectorInput() {}\n  }\n  LoginPage.ɵfac = function LoginPage_Factory(t) {\n    return new (t || LoginPage)(i0.ɵɵdirectiveInject(i1.Alert), i0.ɵɵdirectiveInject(i2.Downloads), i0.ɵɵdirectiveInject(i3.AlertController), i0.ɵɵdirectiveInject(i4.AuthApiService), i0.ɵɵdirectiveInject(i5.ConnApiService), i0.ɵɵdirectiveInject(i6.Router), i0.ɵɵdirectiveInject(i7.FormBuilder), i0.ɵɵdirectiveInject(i8.DataService));\n  };\n  LoginPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoginPage,\n    selectors: [[\"app-login\"]],\n    features: [i0.ɵɵProvidersFeature([Downloads, Alert])],\n    decls: 28,\n    vars: 6,\n    consts: [[\"slot\", \"end\", 1, \"toolbar-buttons-right\"], [\"fill\", \"clear\", 3, \"click\"], [\"slot\", \"icon-only\", \"name\", \"information-circle\", 1, \"toolbar-icon\"], [1, \"toolbar-subtitle\"], [3, \"ngClass\"], [1, \"footer-content\"], [1, \"block-element-single\"], [3, \"ngModel\", \"ngModelChange\", \"ionChange\"], [\"value\", \"1\"], [\"value\", \"2\"], [3, \"ngSwitch\"], [3, \"formGroup\", \"keyup.enter\", \"ngSubmit\", 4, \"ngSwitchCase\"], [3, \"formGroup\", \"ngSubmit\", 4, \"ngSwitchCase\"], [1, \"lower-content\"], [3, \"formGroup\", \"keyup.enter\", \"ngSubmit\"], [\"size-xl\", \"6\", \"size-lg\", \"6\", \"size-md\", \"12\", \"size-sm\", \"12\", \"size-xs\", \"12\"], [\"lines\", \"full\"], [\"position\", \"floating\", 1, \"input-label\"], [\"type\", \"text\", \"required\", \"\", \"formControlName\", \"cEmail\"], [\"class\", \"input-invalid\", 4, \"ngIf\"], [\"type\", \"password\", \"formControlName\", \"cPassword\", \"required\", \"\"], [1, \"ion-row-buttons\"], [\"size-xl\", \"4\", \"size-lg\", \"4\", \"size-md\", \"12\", \"size-sm\", \"12\", \"size-xs\", \"12\"], [\"type\", \"submit\", 1, \"ion-button-one-inside\"], [1, \"ion-button-three-inside\", 3, \"click\"], [1, \"input-invalid\"], [3, \"formGroup\", \"ngSubmit\"], [\"type\", \"text\", \"required\", \"\", \"formControlName\", \"cEmail\", 1, \"input-label\"], [\"disabled\", \"true\", \"type\", \"submit\", 1, \"ion-button-one-inside\"]],\n    template: function LoginPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0)(3, \"ion-button\", 1);\n        i0.ɵɵlistener(\"click\", function LoginPage_Template_ion_button_click_3_listener() {\n          return ctx.onInfo();\n        });\n        i0.ɵɵelement(4, \"ion-icon\", 2);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"ion-title\");\n        i0.ɵɵtext(6, \"Handysammlerportal \");\n        i0.ɵɵelementStart(7, \"p\", 3);\n        i0.ɵɵtext(8, \"Entwickelt von Mobile-Box\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(9, \"ion-content\", 4)(10, \"div\", 5)(11, \"ion-grid\")(12, \"div\", 6)(13, \"ion-segment\", 7);\n        i0.ɵɵlistener(\"ngModelChange\", function LoginPage_Template_ion_segment_ngModelChange_13_listener($event) {\n          return ctx.selectedRole = $event;\n        })(\"ionChange\", function LoginPage_Template_ion_segment_ionChange_13_listener($event) {\n          return ctx.segmentChanged($event);\n        });\n        i0.ɵɵelementStart(14, \"ion-segment-button\", 8)(15, \"ion-label\");\n        i0.ɵɵtext(16, \"Sammler\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"ion-segment-button\", 9)(18, \"ion-label\");\n        i0.ɵɵtext(19, \"Partner\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(20, \"br\");\n        i0.ɵɵelementStart(21, \"div\", 10);\n        i0.ɵɵtemplate(22, LoginPage_form_22_Template, 28, 6, \"form\", 11);\n        i0.ɵɵtemplate(23, LoginPage_form_23_Template, 17, 3, \"form\", 12);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(24, \"br\")(25, \"br\")(26, \"br\")(27, \"app-footer\", 13);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction0(5, _c0));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.selectedRole);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngSwitch\", ctx.selectedRole);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngSwitchCase\", 1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngSwitchCase\", 2);\n      }\n    },\n    dependencies: [i9.NgClass, i9.NgIf, i9.NgSwitch, i9.NgSwitchCase, i7.ɵNgNoValidate, i7.NgControlStatus, i7.NgControlStatusGroup, i7.RequiredValidator, i7.NgModel, i3.IonButton, i3.IonButtons, i3.IonCol, i3.IonContent, i3.IonGrid, i3.IonHeader, i3.IonIcon, i3.IonInput, i3.IonItem, i3.IonLabel, i3.IonRow, i3.IonSegment, i3.IonSegmentButton, i3.IonToolbar, i3.IonTitle, i3.SelectValueAccessor, i3.TextValueAccessor, i7.FormGroupDirective, i7.FormControlName, i10.FooterComponent],\n    styles: [\"[_nghost-%COMP%]   .item-interactive.ion-invalid[_ngcontent-%COMP%]{--highlight-background: #FF !important}[_nghost-%COMP%]   .item-interactive.ion-valid[_ngcontent-%COMP%]{--highlight-background: #FF !important}\"]\n  });\n  return LoginPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}